---
import { cn } from "../utils/merge";

interface Props {
  variant?: "success" | "error" | "info";
  duration?: number;
  class?: string;
  [key: string]: any;
}

const { variant = "info", duration = 5000, class: className, ...rest } = Astro.props;

const variantStyles = {
  success: "border-zen-green/30 bg-zen-green/10 text-dark",
  error: "border-coral/30 bg-coral/10 text-dark",
  info: "border-zen-blue/30 bg-zen-blue/10 text-dark",
};

const iconColors = {
  success: "text-zen-green",
  error: "text-coral",
  info: "text-zen-blue",
};
---

<div
  class={cn(
    "fixed bottom-4 right-4 z-[100] flex items-start gap-3 rounded-lg border px-4 py-3 shadow-lg",
    "animate-[toastSlideIn_200ms_ease-out]",
    "max-w-sm w-full",
    variantStyles[variant],
    className,
  )}
  role="alert"
  data-toast
  data-toast-duration={duration}
  {...rest}
>
  <span class={cn("mt-0.5 shrink-0", iconColors[variant])}>
    {variant === "success" && (
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
        <polyline points="22 4 12 14.01 9 11.01" />
      </svg>
    )}
    {variant === "error" && (
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10" />
        <line x1="15" y1="9" x2="9" y2="15" />
        <line x1="9" y1="9" x2="15" y2="15" />
      </svg>
    )}
    {variant === "info" && (
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10" />
        <line x1="12" y1="16" x2="12" y2="12" />
        <line x1="12" y1="8" x2="12.01" y2="8" />
      </svg>
    )}
  </span>

  <div class="flex-1 text-sm font-medium">
    <slot />
  </div>

  <button
    type="button"
    class="shrink-0 flex h-5 w-5 items-center justify-center rounded text-muted hover:text-dark transition-colors cursor-pointer"
    data-toast-close
    aria-label="Close"
  >
    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="18" y1="6" x2="6" y2="18" />
      <line x1="6" y1="6" x2="18" y2="18" />
    </svg>
  </button>
</div>

<style>
  @keyframes toastSlideIn {
    from {
      opacity: 0;
      transform: translateY(8px) translateX(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0) translateX(0);
    }
  }

  @keyframes toastSlideOut {
    from {
      opacity: 1;
      transform: translateY(0) translateX(0);
    }
    to {
      opacity: 0;
      transform: translateY(8px) translateX(8px);
    }
  }
</style>

<script>
  function initToasts() {
    document.querySelectorAll<HTMLElement>("[data-toast]").forEach((toast) => {
      const duration = parseInt(toast.dataset.toastDuration || "5000", 10);

      function dismissToast() {
        toast.style.animation = "toastSlideOut 200ms ease-in forwards";
        toast.addEventListener("animationend", () => {
          toast.remove();
        }, { once: true });
      }

      // Close button
      const closeBtn = toast.querySelector("[data-toast-close]");
      closeBtn?.addEventListener("click", dismissToast);

      // Auto-dismiss
      if (duration > 0) {
        setTimeout(dismissToast, duration);
      }
    });
  }

  initToasts();
  document.addEventListener("astro:after-swap", initToasts);
</script>
