---
import { cn } from "../utils/merge";

interface Props {
  id: string;
  title?: string;
  class?: string;
  [key: string]: any;
}

const { id, title, class: className, ...rest } = Astro.props;
---

<dialog
  id={id}
  class={cn(
    "fixed inset-0 z-50 m-0 h-full w-full max-h-full max-w-full bg-transparent p-0",
    "backdrop:bg-dark/40 backdrop:backdrop-blur-sm",
    "open:flex open:items-center open:justify-center",
  )}
  {...rest}
>
  <div
    class="modal-backdrop fixed inset-0"
    data-modal-close={id}
  />
  <div
    class={cn(
      "relative z-10 w-full max-w-lg rounded-xl bg-paper border border-dark/[0.08] shadow-xl",
      "mx-4 p-6",
      "animate-[modalSlideIn_200ms_ease-out]",
      className,
    )}
  >
    <div class="flex items-center justify-between mb-4">
      {title && (
        <h2 class="text-lg font-semibold text-dark">{title}</h2>
      )}
      <button
        type="button"
        class="ml-auto flex h-8 w-8 items-center justify-center rounded-lg text-muted hover:bg-dark/5 hover:text-dark transition-colors cursor-pointer"
        data-modal-close={id}
        aria-label="Close"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      </button>
    </div>
    <slot />
  </div>
</dialog>

<style>
  @keyframes modalSlideIn {
    from {
      opacity: 0;
      transform: translateY(8px) scale(0.98);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
</style>

<script>
  function initModals() {
    // Close button / backdrop click
    document.querySelectorAll("[data-modal-close]").forEach((el) => {
      el.addEventListener("click", () => {
        const id = (el as HTMLElement).dataset.modalClose!;
        const dialog = document.getElementById(id) as HTMLDialogElement | null;
        dialog?.close();
      });
    });

    // Close on Escape is built-in for <dialog>
  }

  // Run on initial load and after Astro view transitions
  initModals();
  document.addEventListener("astro:after-swap", initModals);
</script>
