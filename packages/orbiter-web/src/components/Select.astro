---
import { cn } from "../utils/merge";

interface Props {
  label?: string;
  options: { value: string; label: string }[];
  error?: string;
  required?: boolean;
  class?: string;
  [key: string]: any;
}

const { label, options, error, required, class: className, ...rest } = Astro.props;

const selectId = rest.id || rest.name || `select-${Math.random().toString(36).slice(2, 8)}`;
---

<div class={cn("flex flex-col gap-1.5", className)}>
  {label && (
    <label for={selectId} class="text-sm font-medium text-dark">
      {label}
      {required && <span class="text-coral ml-0.5">*</span>}
    </label>
  )}
  <div class="relative">
    <select
      id={selectId}
      class={cn(
        "w-full appearance-none bg-paper border rounded-lg px-3 py-2 pr-8 text-dark transition-all duration-200 outline-none cursor-pointer",
        error
          ? "border-coral focus:ring-2 focus:ring-coral/30"
          : "border-dark/[0.08] focus:border-coral focus:ring-2 focus:ring-coral/20",
      )}
      {...rest}
    >
      {rest.placeholder && (
        <option value="" disabled selected>{rest.placeholder}</option>
      )}
      {options.map((opt) => (
        <option value={opt.value}>{opt.label}</option>
      ))}
    </select>
    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2.5">
      <svg class="h-4 w-4 text-muted" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
      </svg>
    </div>
  </div>
  {error && <p class="text-sm text-coral">{error}</p>}
</div>
