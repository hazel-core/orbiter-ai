---
import "../styles/global.css";
import SEOHead from "../components/SEOHead.astro";

interface Props {
  title?: string;
  description?: string;
  canonicalUrl?: string;
  ogImage?: string;
}

const { title, description, canonicalUrl, ogImage } = Astro.props;
---

<html lang="en">
  <head>
    <SEOHead
      title={title}
      description={description}
      canonicalUrl={canonicalUrl}
      ogImage={ogImage}
    />

    <!-- Blocking theme detection: runs before first paint to prevent flash -->
    <script is:inline>
      (function () {
        var stored = localStorage.getItem("theme");
        var preferred = stored || (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
        document.documentElement.setAttribute("data-theme", preferred);
      })();
    </script>
  </head>
  <body class="bg-paper text-dark">
    <slot />

    <!-- IntersectionObserver for data-animate elements -->
    <script is:inline>
      (function () {
        var prefersReducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;

        if (prefersReducedMotion) {
          // Show all animated elements immediately without animation
          document.querySelectorAll("[data-animate]").forEach(function (el) {
            el.style.opacity = "1";
            el.style.transform = "none";
          });
          return;
        }

        var observer = new IntersectionObserver(
          function (entries) {
            entries.forEach(function (entry) {
              if (entry.isIntersecting) {
                var animName = entry.target.getAttribute("data-animate") || "zenReveal";
                entry.target.style.animation = animName + " 0.6s ease-out forwards";
                observer.unobserve(entry.target);
              }
            });
          },
          { threshold: 0.1 }
        );

        document.querySelectorAll("[data-animate]").forEach(function (el) {
          el.style.opacity = "0";
          observer.observe(el);
        });
      })();
    </script>
  </body>
</html>
