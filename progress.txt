# Ralph Progress Log
Started: Mon Feb 16 2026

## Codebase Patterns
- UV workspace monorepo: 13 packages under `packages/`, root pyproject.toml has NO build-system
- Namespace packages: `orbiter-core/__init__.py` uses `pkgutil.extend_path()` so other packages add to the `orbiter` namespace
- Quality checks: `uv run ruff check packages/`, `uv run ruff format --check packages/`, `uv run pyright packages/orbiter-core/`, `uv run pytest`
- Test file names must be unique across all packages (pytest collects `tests/` from multiple packages into one `tests` module)
- pytest-asyncio `asyncio_mode = "auto"` configured in root pyproject.toml
- Use `StrEnum` (not `str, Enum`) for string enums — ruff UP042 enforces this
- pyright ignore comments: put `# pyright: ignore[reportMissingImports]` on the import line itself
- Use test prefix `test_obs_*.py` for orbiter-observability to avoid collision with orbiter-core test names
- OTel optional imports: use `try/except ImportError` pattern with `HAS_OTEL` flag
- OTel `trace.set_tracer_provider()` can only be called once — in tests, reset internal state before each test
- OTel metrics instruments created at module level bind to the no-op provider — create instruments inside recording functions
- Ruff B039: `ContextVar` default cannot be mutable — use `default=None` with `T | None` type
- `@asynccontextmanager` returns single-use CMs — when mocking, use `side_effect=lambda: factory()` not `return_value=cm`
- Don't use `# noqa: PLW0603` or `# noqa: S101` — those rules aren't enabled in ruff config (ruff RUF100 catches unused noqa)
- hatchling requires a README.md in each package directory (build fails without it)
- Ruff UP017: use `datetime.UTC` alias, not `datetime.timezone.utc`
---

## 2026-02-16 - US-001
- Created orbiter-observability package scaffold under packages/orbiter-observability/
- ObservabilityConfig pydantic model with log_level, log_format, trace_enabled, trace_backend, trace_endpoint, service_name, sample_rate, metrics_enabled, namespace
- TraceBackend StrEnum (otlp/memory/console)
- configure() function with idempotency, force=True, kwargs support
- get_config() and reset() helper functions
- 14 tests covering config validation, configure idempotency, kwargs override, frozen model, bounds
- Files changed: pyproject.toml (root), packages/orbiter-observability/{pyproject.toml, README.md, src/orbiter/observability/__init__.py, src/orbiter/observability/config.py, tests/test_obs_config.py}
- **Learnings for future iterations:**
  - hatchling requires README.md in each package dir — add it early
  - Ruff linting catches unused noqa directives — don't add PLW0603/S101 suppressions since those rules aren't enabled
  - ObservabilityConfig follows same frozen=True pattern as TraceConfig
---

## 2026-02-16 - US-002
- Implemented structured logging module at `packages/orbiter-observability/src/orbiter/observability/logging.py` (~170 lines)
- TextFormatter: compact single-line ANSI output ported from orbiter.log._Formatter, enhanced with LogContext support
- JsonFormatter: structured {timestamp, level, logger, message, extra} JSON output for production
- get_logger(name) with auto "orbiter." namespace prefixing
- configure_logging(level, fmt, force) with idempotency, text/json format selection
- LogContext context manager using contextvars for async-safe structured bindings
- reset_logging() for test cleanup
- 33 tests covering both formatters, namespace auto-prefixing, idempotency, LogContext binding/nesting/override
- Files changed: packages/orbiter-observability/src/orbiter/observability/logging.py, packages/orbiter-observability/tests/test_obs_logging.py
- **Learnings for future iterations:**
  - Ruff UP017: use `datetime.UTC` alias instead of `datetime.timezone.utc`
  - ContextVar with `default=None` and `T | None` type is the right pattern (confirmed from Codebase Patterns)
  - LogContext nesting works by merging parent context into child — child overrides take precedence
  - Text/JSON formatter tests should set `_log_context` directly for unit testing (no need to use LogContext CM in formatter tests)
---
